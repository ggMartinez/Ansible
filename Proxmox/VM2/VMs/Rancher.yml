  - name: Set Apache URL
    set_fact:
      vmName: K8s---Rancher

  - name: Create Rancher VM
    community.general.proxmox_kvm:
      api_user: "{{ proxmoxUser }}"
      api_password: "{{ proxmoxPassword }}"
      api_host: "{{ proxmoxIP }}"
      clone: "{{ proxmoxCentosTemplate }}"
      name: "{{ vmName }}"
      node: "{{ proxmoxNode }}"
      proxmox_default_behavior: "no_defaults"
      full: no


  - name: Update Rancher VM Settings
    community.general.proxmox_kvm:
      api_user: "{{ proxmoxUser }}"
      api_password: "{{ proxmoxPassword }}"
      api_host: "{{ proxmoxIP }}"
      name: "{{ vmName }}"
      node: "{{ proxmoxNode }}"
      cores: 2
      memory: 2048
      nameservers: "192.168.1.254"
      searchdomains: "ggmartinez.duckdns.org"
      ipconfig:
        ipconfig0: 'ip=192.168.1.50/24,gw=192.168.1.1'
      virtio:
        virtio0: 'local-lvm:10'
        virtio1: 'local-lvm:10'
      update: true